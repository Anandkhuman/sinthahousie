<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resilient P2P Chat</title>
    <!-- Google Fonts & Font Awesome -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- CSS STYLES EMBEDDED -->
    <style>
        :root {
            --bg-color: #121212; --card-bg: #1e1e1e; --primary-color: #0d47a1;
            --secondary-color: #bb86fc; --text-color: #e0e0e0; --input-bg: #2c2c2c;
            --font-family: 'Poppins', sans-serif; --success-color: #03dac6;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color);
            overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;
        }
        #bg { position: fixed; top: 0; left: 0; z-index: -1; }
        .app-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .screen { display: none; width: 100%; max-width: 420px; opacity: 0; transform: scale(0.95); }
        .screen.active { display: block; opacity: 1; transform: scale(1); }
        .card {
            background-color: var(--card-bg); padding: 30px 35px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); text-align: center; border: 1px solid #333;
        }
        h1, h2, h3 { color: white; margin-bottom: 10px; }
        p { margin-bottom: 20px; font-size: 0.9rem; line-height: 1.6; color: #b0b0b0; }
        input[type="text"] {
            width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #444; border-radius: 8px;
            background-color: var(--input-bg); color: var(--text-color); font-family: var(--font-family); font-size: 1rem; transition: border-color 0.3s;
        }
        input[type="text"]:focus { outline: none; border-color: var(--secondary-color); }
        button {
            width: 100%; padding: 12px; background-color: var(--secondary-color); color: #000;
            border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;
            transition: background-color 0.3s, transform 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        button:hover { background-color: #d1a5ff; }
        button:active { transform: scale(0.98); }
        button.secondary-action { background-color: var(--primary-color); color: white; margin-top: 10px; }
        button.secondary-action:hover { background-color: #1e5abc; }
        button#create-room-btn { background-color: var(--success-color); }
        button#create-room-btn:hover { background-color: #36fddc; }
        .divider { margin: 20px 0; font-weight: bold; color: #555; position: relative; }
        .name-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .name-container .edit-name-btn { all: unset; cursor: pointer; color: #888; transition: color 0.3s; }
        .name-container .edit-name-btn:hover { color: var(--secondary-color); }
        .room-code-container { margin-top: 20px; padding: 15px; background-color: var(--input-bg); border-radius: 8px; text-align: left; }
        .code-box { background: var(--bg-color); padding: 10px; border-radius: 5px; word-wrap: break-word; margin: 10px 0; font-weight: bold; text-align: center; border: 1px dashed var(--secondary-color); user-select: all; }
        .room-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        #enter-room-btn { grid-column: 1 / -1; background-color: var(--success-color); }
        #enter-room-btn:hover { background-color: #36fddc; }
        .chat-container { width: 100%; max-width: 700px; height: 90vh; background: var(--card-bg); border-radius: 15px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); border: 1px solid #333; }
        .chat-header { padding: 15px 20px; background: #2a2a2a; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; }
        #leave-btn { width: auto; padding: 8px 20px; font-size: 0.9rem; background: #c62828; color: white; }
        .messages { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 1px; }
        .message { margin-bottom: 15px; max-width: 75%; display: flex; flex-direction: column; }
        .message.sent { align-self: flex-end; align-items: flex-end; }
        .message.received { align-self: flex-start; align-items: flex-start; }
        .message .sender-name { font-size: 0.75rem; color: #aaa; margin-bottom: 4px; margin-left: 12px; margin-right: 12px; }
        .message-bubble { padding: 10px 15px; border-radius: 20px; line-height: 1.4; word-wrap: break-word; }
        .message.sent .message-bubble { background: var(--primary-color); color: white; border-bottom-right-radius: 5px; }
        .message.received .message-bubble { background: #363636; color: var(--text-color); border-bottom-left-radius: 5px; }
        .message.system { align-self: center; text-align: center; font-style: italic; color: #888; font-size: 0.8rem; background: #2c2c2c; padding: 5px 15px; border-radius: 20px; }
        .chat-input-form { display: flex; padding: 15px; border-top: 1px solid #333; gap: 10px; }
        .chat-input-form input { margin-bottom: 0; }
        .chat-input-form button { width: auto; padding: 0 25px; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; color: white; font-size: 1.2rem; flex-direction: column; }
    </style>
</head>
<body>
    <canvas id="bg"></canvas>
    <div class="loading-overlay" id="loading-overlay"><p id="loading-text">Connecting...</p></div>
    <div class="app-container">
        <div id="welcome-screen" class="screen">
            <div class="card">
                <h1><i class="fas fa-comments" style="color: var(--secondary-color);"></i> Resilient Chat</h1>
                <p>A truly decentralized chat application. Rooms stay alive as long as one person remains.</p>
                <form id="name-form"><input type="text" id="name-input" placeholder="Enter Your Name" required autocomplete="off"><button type="submit">Continue <i class="fas fa-arrow-right"></i></button></form>
            </div>
        </div>
        <div id="lobby-screen" class="screen">
            <div class="card">
                <div class="name-container"><h2 id="welcome-message"></h2><button class="edit-name-btn" id="edit-name-btn" title="Edit Name"><i class="fas fa-pencil-alt"></i></button></div>
                <div id="rejoin-container"></div>
                <button id="create-room-btn">Create a New Room <i class="fas fa-plus-circle"></i></button>
                <div class="divider">OR</div>
                <form id="join-form"><input type="text" id="join-code-input" placeholder="Enter Room Code" required autocomplete="off"><button type="submit">Join Room <i class="fas fa-sign-in-alt"></i></button></form>
                <div id="room-code-display" class="room-code-container" style="display: none;">
                    <p>Your room is ready! Share this code:</p>
                    <div id="room-code" class="code-box"></div>
                    <div class="room-actions">
                        <button id="enter-room-btn"><i class="fas fa-door-open"></i> Enter Room</button>
                        <button id="share-btn"><i class="fas fa-share-alt"></i> Share</button>
                        <button id="copy-code-btn"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="chat-screen" class="screen">
            <div class="chat-container">
                <div class="chat-header"><h3 id="chat-room-title">Chat Room</h3><button id="leave-btn"><i class="fas fa-sign-out-alt"></i> Leave</button></div>
                <div class="messages" id="message-container"></div>
                <form class="chat-input-form" id="chat-form"><input type="text" id="chat-input" placeholder="Type a message..." autocomplete="off"><button type="submit">Send <i class="fas fa-paper-plane"></i></button></form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const screens = { welcome: document.getElementById('welcome-screen'), lobby: document.getElementById('lobby-screen'), chat: document.getElementById('chat-screen') };
        const loadingOverlay = document.getElementById('loading-overlay'), loadingText = document.getElementById('loading-text');
        const nameForm = document.getElementById('name-form'), nameInput = document.getElementById('name-input');
        const welcomeMessage = document.getElementById('welcome-message'), editNameBtn = document.getElementById('edit-name-btn');
        const createRoomBtn = document.getElementById('create-room-btn'), joinForm = document.getElementById('join-form'), joinCodeInput = document.getElementById('join-code-input');
        const roomCodeDisplay = document.getElementById('room-code-display'), roomCodeEl = document.getElementById('room-code');
        const copyCodeBtn = document.getElementById('copy-code-btn'), shareBtn = document.getElementById('share-btn'), enterRoomBtn = document.getElementById('enter-room-btn');
        const chatRoomTitle = document.getElementById('chat-room-title');
        const messageContainer = document.getElementById('message-container'), chatForm = document.getElementById('chat-form'), chatInput = document.getElementById('chat-input');
        const leaveBtn = document.getElementById('leave-btn'), rejoinContainer = document.getElementById('rejoin-container');

        // --- App State ---
        let peer, username = '', currentRoomId = null, currentRoomName = '', roomToJoinFromUrl = null;
        let connections = {}, knownPeers = [];

        // --- UI Functions ---
        const tl = gsap.timeline({ defaults: { duration: 0.4, ease: "power2.inOut" }});
        const showScreen = (screen) => {
            const currentActive = document.querySelector('.screen.active');
            if (currentActive) tl.to(currentActive, { opacity: 0, scale: 0.95, onComplete: () => currentActive.classList.remove('active') });
            tl.to(screen, { opacity: 1, scale: 1, onComplete: () => screen.classList.add('active') }, currentActive ? ">-0.2" : ">");
        };
        const showLoading = (show, text = 'Connecting...') => {
            loadingText.textContent = text;
            loadingOverlay.style.display = show ? 'flex' : 'none';
        };
        
        // --- 3D Background ---
        (() => {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg'), antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.position.z = 2;
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 8000;
            const posArray = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i++) posArray[i] = (Math.random() - 0.5) * (Math.random() * 50);
            starGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const starMaterial = new THREE.PointsMaterial({ size: 0.008, color: 0xbb86fc, transparent: true, opacity: 0.8 });
            const starMesh = new THREE.Points(starGeometry, starMaterial);
            scene.add(starMesh);
            let mouseX = 0, mouseY = 0;
            document.addEventListener('mousemove', e => {
                mouseX = (e.clientX - window.innerWidth / 2) / 100;
                mouseY = (e.clientY - window.innerHeight / 2) / 100;
            });
            const animate = () => {
                requestAnimationFrame(animate);
                starMesh.rotation.y += 0.0001;
                camera.position.x += (mouseX - camera.position.x) * 0.01;
                camera.position.y += (-mouseY - camera.position.y) * 0.01;
                camera.lookAt(scene.position);
                renderer.render(scene, camera);
            };
            animate();
            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            });
        })();

        // --- Initialization ---
        const initialize = () => {
            const urlParams = new URLSearchParams(window.location.search);
            roomToJoinFromUrl = urlParams.get('room');
            const savedName = localStorage.getItem('resilient-chat-username');
            if (savedName) {
                username = savedName;
                initLobby();
            } else {
                screens.welcome.classList.add('active');
            }
        };

        const initLobby = () => {
            welcomeMessage.textContent = `Welcome, ${username}!`;
            rejoinContainer.innerHTML = '';
            const lastRoom = localStorage.getItem('resilient-chat-lastroom');
            if (lastRoom) {
                const lastRoomState = getRoomState(lastRoom);
                const lastRoomName = lastRoomState ? lastRoomState.roomName : `Room ${lastRoom.substring(0,6)}`;
                rejoinContainer.innerHTML = `<button id="rejoin-btn" class="secondary-action"><i class="fas fa-history"></i> Rejoin "${lastRoomName}"</button>`;
                document.getElementById('rejoin-btn').onclick = () => joinRoom(lastRoom);
            }
            roomCodeDisplay.style.display = 'none';
            showScreen(screens.lobby);
            initPeer();
        };

        // --- Name Handling ---
        nameForm.addEventListener('submit', (e) => { e.preventDefault(); const n = nameInput.value.trim(); if(n){username = n; localStorage.setItem('resilient-chat-username', username); initLobby();} });
        
        editNameBtn.addEventListener('click', () => {
            const newName = prompt("Enter your new name:", username);
            if (newName && newName.trim() !== "" && newName.trim() !== username) {
                const oldName = username;
                username = newName.trim();
                localStorage.setItem('resilient-chat-username', username);
                welcomeMessage.textContent = `Welcome, ${username}!`;
                const systemMessage = {type: 'name-change', oldName, newName: username };
                broadcast(systemMessage);
                displayMessage(systemMessage);
                saveMessageToHistory(systemMessage);
            }
        });

        // --- PeerJS & Core Connection Logic ---
        const initPeer = () => {
            if (peer) peer.destroy();
            const peerConfig = {
                config: {
                    'iceServers': [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' },
                        { urls: "turn:openrelay.metered.ca:80", username: "openrelayproject", credential: "openrelayproject" },
                        { urls: "turn:openrelay.metered.ca:443", username: "openrelayproject", credential: "openrelayproject" }
                    ]
                }
            };
            peer = new Peer(peerConfig);
            peer.on('open', id => {
                console.log('My PeerJS ID is:', id);
                if (roomToJoinFromUrl) { joinRoom(roomToJoinFromUrl); roomToJoinFromUrl = null; }
            });
            peer.on('connection', handleNewConnection);
            peer.on('error', err => {
                console.error('PeerJS error:', err);
                if (err.type === 'peer-unavailable') {
                    // This is a common, non-fatal error when trying multiple peers.
                    console.warn(`Peer ${err.message.split(' ').pop()} was unavailable.`);
                } else {
                    showLoading(false);
                    alert(`A connection error occurred: ${err.message}.`);
                }
            });
        };
        
        const handleNewConnection = (conn) => {
            conn.on('open', () => {
                if (screens.lobby.classList.contains('active')) {
                    showScreen(screens.chat);
                    displaySystemMessage(`You are now in room "${currentRoomName}".`);
                }
                conn.send({ type: 'welcome', roomName: currentRoomName, history: getMessageHistory(), peers: knownPeers, senderName: username });
                addPeer(conn.peer);
                broadcast({ type: 'peer-joined', peerId: conn.peer });
                connections[conn.peer] = conn;
                connections[conn.peer].username = "New User";
            });
            conn.on('data', data => handleData(data, conn.peer));
            conn.on('close', () => handleDisconnect(conn.peer));
        };
        
        const handleData = (data, peerId) => {
            const conn = connections[peerId];
            if (conn) conn.username = data.senderName;
            
            switch(data.type) {
                case 'welcome':
                    currentRoomName = data.roomName;
                    chatRoomTitle.textContent = currentRoomName;
                    knownPeers = [...new Set([peer.id, ...data.peers, peerId])];
                    loadMessageHistory(data.history);
                    displaySystemMessage(`${data.senderName} welcomed you to "${currentRoomName}".`);
                    saveState();
                    break;
                case 'message': case 'name-change':
                    displayMessage(data);
                    saveMessageToHistory(data);
                    break;
                case 'peer-joined':
                    if (peer.id !== data.peerId) {
                        addPeer(data.peerId);
                        displaySystemMessage(`${data.senderName} has joined.`);
                    }
                    break;
                case 'peer-left':
                    displaySystemMessage(`${data.senderName} has left.`);
                    removePeer(data.peerId);
                    break;
            }
        };

        const handleDisconnect = (peerId) => {
            if (!connections[peerId]) return;
            const peerName = connections[peerId].username || 'A user';
            delete connections[peerId];
            removePeer(peerId);
            const systemMessage = { type: 'peer-left', peerId: peerId, senderName: peerName };
            broadcast(systemMessage);
            displayMessage(systemMessage);
            saveMessageToHistory(systemMessage);
        };

        const broadcast = (data) => {
            data.senderName = username;
            Object.values(connections).forEach(conn => conn.open && conn.send(data));
        };
        
        // --- Room Management ---
        createRoomBtn.addEventListener('click', () => {
            if (!peer || !peer.id) { alert('Connection not established yet. Please wait a moment.'); return; }
            const roomName = prompt("Enter a name for your new chat room:", "General Chat");
            if (roomName && roomName.trim() !== "") {
                currentRoomId = peer.id;
                currentRoomName = roomName.trim();
                knownPeers = [peer.id];
                chatRoomTitle.textContent = currentRoomName;
                localStorage.setItem(getRoomStateKey(currentRoomId), JSON.stringify({ roomName: currentRoomName, peers: [peer.id], messages: [] }));
                localStorage.setItem('resilient-chat-lastroom', currentRoomId);
                roomCodeEl.textContent = currentRoomId;
                roomCodeDisplay.style.display = 'block';
                gsap.from(roomCodeDisplay, { opacity: 0, y: 20, duration: 0.3 });
            }
        });
        
        enterRoomBtn.addEventListener('click', () => {
            if (currentRoomId && screens.lobby.classList.contains('active')) {
                showScreen(screens.chat);
                loadLocalRoomState(currentRoomId); 
                displaySystemMessage(`You are now in room "${currentRoomName}". Waiting for others to join...`);
            }
        });

        shareBtn.addEventListener('click', () => {
            const shareUrl = `${window.location.origin}${window.location.pathname}?room=${currentRoomId}`;
            const shareData = {
                title: 'Join My Resilient Chat Room!',
                text: `Let's chat! Join my room "${currentRoomName}" with this link.`,
                url: shareUrl,
            };
            if (navigator.share) {
                navigator.share(shareData).catch((error) => console.log('Error sharing', error));
            } else {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    shareBtn.innerHTML = '<i class="fas fa-check"></i> Link Copied!';
                    setTimeout(() => { shareBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share' }, 2000);
                });
            }
        });

        copyCodeBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(currentRoomId).then(() => {
                copyCodeBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => { copyCodeBtn.innerHTML = '<i class="fas fa-copy"></i> Copy' }, 2000);
            });
        });

        joinForm.addEventListener('submit', (e) => { e.preventDefault(); const code = joinCodeInput.value.trim(); if(code) joinRoom(code); });
        
        const joinRoom = async (roomId) => {
            if (!peer || peer.disconnected) { alert('Connection not established yet.'); return; }
            if (Object.keys(connections).length > 0) { alert("You are already in a room. Please leave first."); return; }
            showLoading(true, `Joining room...`);
            currentRoomId = roomId;
            loadLocalRoomState(roomId);
            const peersToTry = [...new Set([roomId, ...knownPeers])];
            let connected = false;
            for (const peerId of peersToTry) {
                if (peerId === peer.id) continue;
                try {
                    showLoading(true, `Trying ${peerId.substring(0, 8)}...`);
                    const conn = peer.connect(peerId, { metadata: { username }});
                    await new Promise((resolve, reject) => {
                        conn.on('open', () => {
                            connections[peerId] = conn;
                            conn.on('data', data => handleData(data, peerId));
                            conn.on('close', () => handleDisconnect(peerId));
                            connected = true;
                            resolve();
                        });
                        conn.on('error', err => reject(err));
                        setTimeout(() => reject(new Error('Connection timed out')), 5000);
                    });
                    if (connected) break;
                } catch (err) { console.warn(`Failed to connect to peer ${peerId}:`, err.message); }
            }
            showLoading(false);
            if (connected) {
                showScreen(screens.chat);
            } else {
                alert(`Could not connect to room "${roomId}". It may be empty or the peers are unreachable.`);
                currentRoomId = null;
            }
        };

        leaveBtn.addEventListener('click', () => {
            broadcast({ type: 'peer-left', peerId: peer.id });
            Object.values(connections).forEach(conn => conn.close());
            connections = {};
            currentRoomId = null;
            currentRoomName = '';
            knownPeers = [];
            messageContainer.innerHTML = '';
            history.pushState(null, '', window.location.pathname);
            initLobby();
        });
        
        // --- State & History Management ---
        const getRoomStateKey = (id) => `chat-state-${id}`;
        const saveState = () => {
            if (!currentRoomId) return;
            const state = { roomName: currentRoomName, peers: knownPeers, messages: getMessageHistory() };
            localStorage.setItem(getRoomStateKey(currentRoomId), JSON.stringify(state));
            localStorage.setItem('resilient-chat-lastroom', currentRoomId);
        };
        const getRoomState = (roomId) => JSON.parse(localStorage.getItem(getRoomStateKey(roomId)) || 'null');
        const getMessageHistory = () => (getRoomState(currentRoomId) || {}).messages || [];
        const saveMessageToHistory = (message) => {
            if (!currentRoomId) return;
            const history = getMessageHistory();
            history.push(message);
            const currentState = getRoomState(currentRoomId) || { roomName: currentRoomName, peers: knownPeers, messages: [] };
            currentState.messages = history.slice(-100);
            localStorage.setItem(getRoomStateKey(currentRoomId), JSON.stringify(currentState));
        };
        const loadMessageHistory = (history) => {
            messageContainer.innerHTML = '';
            history.forEach(msg => displayMessage(msg));
        };
        const loadLocalRoomState = (roomId) => {
            const state = getRoomState(roomId);
            if (state) {
                currentRoomName = state.roomName;
                knownPeers = state.peers;
                chatRoomTitle.textContent = currentRoomName;
                loadMessageHistory(state.messages);
            }
        };
        const addPeer = (peerId) => { if (!knownPeers.includes(peerId)) { knownPeers.push(peerId); saveState(); } };
        const removePeer = (peerId) => { knownPeers = knownPeers.filter(p => p !== peerId); saveState(); };

        // --- Message Display ---
        chatForm.addEventListener('submit', (e) => { e.preventDefault(); const content = chatInput.value.trim(); if (content) { const msg = { type: 'message', content, senderName: username }; broadcast(msg); displayMessage(msg); saveMessageToHistory(msg); chatInput.value = ''; } });
        const displaySystemMessage = (content) => displayMessage({ type: 'system', content });
        const displayMessage = (msg) => {
            const div = document.createElement('div');
            div.classList.add('message');
            if (msg.type === 'system') {
                div.classList.add('system');
                div.textContent = msg.content;
            } else if (msg.type === 'name-change') {
                div.classList.add('system');
                div.textContent = `${msg.oldName} is now known as ${msg.newName}.`;
            } else {
                div.classList.add(msg.senderName === username ? 'sent' : 'received');
                div.innerHTML = `<div class="sender-name">${msg.senderName}</div><div class="message-bubble">${msg.content}</div>`;
            }
            messageContainer.appendChild(div);
            if (document.hidden === false) {
                gsap.from(div, { opacity: 0, y: 10, duration: 0.3 });
            }
            messageContainer.scrollTop = messageContainer.scrollHeight;
        };

        // --- Start the App ---
        initialize();
    });
    </script>
</body>
</html>
